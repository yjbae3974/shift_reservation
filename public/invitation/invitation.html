<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Enter-친구초대</title>
    <!-- MDB icon -->
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" />
    <!-- Google Fonts Roboto -->
    <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
    />
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="invitation.css">
    <link rel="stylesheet" href="../register/register.css">
    <link href='https://fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'> 
    
    <style>
      .post-slider .card{
        border-radius: 2rem !important;
        height: 464px;
        margin: 0px 20px;
        background-color: transparent;
        box-shadow: none;
       
        
      }
      .form-control::placeholder{
        color: #bfbfbf!important;
      }
      .slick-slide{
        border-radius: 1rem;
      }
      button{
        background-color: transparent;
        border: none;

      }
      .input-left{
        border-radius: 0px !important;
      }
      .form-control{
        background-color: transparent!important;
      }
      .form-control::placeholder{
        color: #fff!important;
      }
      .form-control:focus{
        border-color: #fff!important;
      }
      .table>:not(caption)>*>* {
          padding: 7.5px 1.4rem !important;
      }
      .btn-sub{
        border-radius: 0px;
        background-color: #fff;
        color: #101D2D;
        font-size: 28px;

      }
      @media(min-width:2000px){.container,.container-lg,.container-md,.container-sm,.container-xl,.container-xxl{max-width:1920px!important}}
     
      .slick-slider, .slick-list, .slick-track{
        height: 564px;
      }
      .card-body{
        width: 450px;
      }
      @media(max-width: 992px){
       
      }
    </style>
    
    <!-- MDB -->
    <link rel="stylesheet" href="../css/mdb.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <script  src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script src="../js/slick.js"></script>
  
    <script>
      $(document).ready(function(){
        $("#footer").load("../footer.html");
      });
      /*$(document).ready(function(){
          //Example - show a div after 75% of the web page is scrolled.
          var webpage = $("body");
          var webpage_height = webpage.height();
          //alert(webpage_height);
          var trigger_height = webpage_height * 0.5;

          if ($(window).scrollTop() > (webpage_height-trigger_height)) {
            alert($(window).scrollTop()+" > "+(webpage_height-trigger_height));
            //$("#divtoshow").show();
          }
      });*/

      
      
    </script>
  </head>
  <body style="height: 100vh;">
    <div id="navbar"></div>
    <div class="container-fluid bg-container body-h" style="margin-top:113px; padding: 0px;">
      <div class="container-fluid bg-ver body-h" style="padding: 0px;">
        <div class="hr-1"></div>
        <div class="hr-2"></div>
        
        <div class="container bg-ver2 d-flex mobile-ver-center body-h" style="">
          <div class="hr-3"></div>
          <div class="hr-4"></div>
          <div class="hr-7"></div>
          <div class="container" style="height: 757px;padding: 0px;position: relative;">
            <div class="circle-1"></div>
            <div class="circle-2"></div>
            <div class="hr-8"></div>
            <div class="container" style="max-width: 1320px!important;">
              <div class="row">
                <div class="col-lg-6 mobile-nopad mobile-middle" style="padding: 16px;">
                   <div class="invitepage">
                       <div class="invititle">Invite your Friends</div>
                        <div class="logo">
                            <div class="parts1"></div>
                            <div class="parts2"></div>
                        </div>
                        <div class="d-flex align-items-center" style="flex-direction: column;">
                            <div class="circle-outline">
                                <div class="inner-circle">
                                    <img id="userProfile" src="..\img\kangwongi.png" class="inner-img" alt="" style="">
                                </div>
                            </div>
                            <div class="mt-3 id-name" id="userId">user ID</div>
                            <div style="font-size: 23px; color: #30b1c1;margin-top:-10px">Reservation Complete</div>
                            <div class="mt-3 text-center" style="font-size: 20px;">
                                '<span id="userId2">user ID</span>' 님은 <span style="color: #74dd72;font-weight: 700;">사전예약</span>을 <span style="color: #74dd72;font-weight: 700;">완료하신</span> 상태입니다.<br>
                                친구를 사이트에 초대하여<br>
                                함께 서비스와 혜택을 즐겨보세요!
                            </div>
                            <div class="your-email mt-3" id="userEmail">userid@gmail.com</div><!--가입한 이메일 여기다가 표시-->
                            <div class="mt-4 invitefriend">친구 초대하기</div>
                            <div class="mt-3" style="width: 20%;height: 3px;background-color: #17375E;"></div>
                            
                        </div>
                        <div class="d-flex justify-content-between mt-4" style="padding: 0px 22px">
                            <a href=""><i class="fab fa-facebook hreficon"></i></a>
                            <a href=""><i class="fab fa-instagram hreficon"></i></a>
                            <a href=""><img class="hreficon" src="..\img\kakaotalk.png" alt=""></a>
                            <a href="">
                                <div style="border-radius: 50%;height: 34px;width: 34px;background-color: #17375e;">
                                    <div class="text-white text-center d-flex align-items-center justify-content-center" style="font-size: 6px;">
                                        링크<br>복사
                                    </div>
                                </div>
                            </a>
                        </div>
                       
                   </div>   
              </div>
                <div class="col-lg-6 mobile-nopad  mobile-middle" style="height: 757px; padding: 0px 30px; z-index: 1;position: relative;border-right: 1px solid #fff">
                  <div class="hr-9"></div>
                  <div>
                      <p class="invit-title">Invitation Ranking</p>
                      <table class="table table-borderless align-middle text-center" style="color: white;">
                          <thead>
                              <tr>
                                  <th>Rank</th>
                                  <th>ID</th>
                                  <th>Number of Invitation</th>
                              </tr>
                          </thead>

                          <tbody id="content-placeholder"></tbody>
                          <!--<tbody>
                              <tr>
                                  <th>1</th>
                                  <th>kim***31</th>
                                  <th>70</th>
                              </tr>
                              <tr>
                                <th>2</th>
                                <th>kim***31</th>
                                <th>70</th>
                            </tr>
                            <tr>
                                <th>3</th>
                                <th>kim***31</th>
                                <th>70</th>
                            </tr>
                            <tr>
                                <th>4</th>
                                <th>kim***31</th>
                                <th>70</th>
                            </tr>
                            <tr>
                                <th>5</th>
                                <th>kim***31</th>
                                <th>70</th>
                            </tr>
                            <tr>
                                <th>6</th>
                                <th>kim***31</th>
                                <th>70</th>
                            </tr>
                            <tr>
                                <th>7</th>
                                <th>kim***31</th>
                                <th>70</th>
                            </tr>
                            <tr>
                                <th>8</th>
                                <th>kim***31</th>
                                <th>70</th>
                            </tr>
                            <tr>
                                <th>9</th>
                                <th>kim***31</th>
                                <th>70</th>
                            </tr>
                            <tr>
                                <th>10</th>
                                <th>kim***31</th>
                                <th>70</th>
                            </tr>

                          </tbody>-->

                      </table>
                      <p class="invit-title mt-4">Copy Invitation Code</p>
                      <div class="d-flex" style="height: 60px;max-width: 700px">
                        <input type="email" id="invitationLink" style="width: 80%;color: #fff" class="form-control input-left">
                        <button type="submit" class="btn-sub" onclick="copyToClipboard('#invitationLink');">복사</button>
                      </div>
                      <p class="mt-1" style="font-size: 18px; color: #30b1c1;">*친구가 초대코드를 통해 들어와서 회원가입시 초대수가 올라갑니다.</p>
                  </div>
              </div>
              </div>
          </div>
          </div>
        </div>
        
    </div>
    </div>
    
    <footer id="footer"></footer>
    
    <script id="invitation-template" type="text/x-handlebars-template">
      {{#contents}}
      <tr>
          <th>{{rank}}</th>
          <th>{{userId}}</th>
          <th>{{inviteNum}}</th>
      </tr>
      {{/contents}}
      <tr>
          <th>...</th>
          <th>...</th>
          <th>...</th>
      </tr>
      <tr style="border: 1px solid #fff">
          <th>1</th>
          <th>kim***31</th>
          <th>70</th>
      </tr>
    </script>

    <!-- MDB -->
    <script type="text/javascript" src="../js/mdb.min.js"></script>
    
    <!-- Custom scripts -->
    <script type="text/javascript">
    $(document).ready(function(){
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      var firebaseConfig = {
        apiKey: "AIzaSyA0E-3mY4_qBgV7RfxEdzcU4B7xjJ74e-c",
        authDomain: "enter-ef3a8.firebaseapp.com",
        databaseURL: "https://enter-ef3a8-default-rtdb.firebaseio.com",
        projectId: "enter-ef3a8",
        storageBucket: "enter-ef3a8.appspot.com",
        messagingSenderId: "505540008688",
        appId: "1:505540008688:web:d3d89e4a7ac7ba57178035",
        measurementId: "G-88XNV769FN"
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();

      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          $("#navbar").load('../navbar/afterlogin.html');
          console.log(user)		// 인증 후 어떤 데이터를 받아오는지 확인해보기 위함.
          document.getElementById("userEmail").innerHTML = user.email;
          var emailSplit = user.email.split('@');
          document.getElementById("userId").innerHTML = emailSplit[0];
          document.getElementById("userId2").innerHTML = emailSplit[0];
          getUserData(getUserSnapshot());

          document.getElementById("invitationLink").value = "https://enter-ef3a8.web.app/register/register.html?uid="+user.uid;
          document.getElementById("invitationLink").disabled = true;
        } else {
          $("#navbar").load('../navbar/beforelogin.html');
          window.location.href='../login/login.htnl';
          // No user is signed in.
        }
      });
    });
    $(window).load(function(){
      $('#친구초대').addClass('active');
    });
    </script>
    <script type="text/javascript" src="../js/pageSlide.js"></script>
    <script src="../js/reservation.js"></script>
    <script src="register.js"></script>
    
  </body>
  <!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-analytics.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-database.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.6/handlebars.min.js" integrity="sha512-zT3zHcFYbQwjHdKjCu6OMmETx8fJA9S7E6W7kBeFxultf75OPTYUJigEKX58qgyQMi1m1EgenfjMXlRZG8BXaw==" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<script>
function copyToClipboard(element) {
  var $temp = $("<input>");
  $("body").append($temp);
  $temp.val($(element).val()).select();
  document.execCommand("copy");
  $temp.remove();
}

var source   = $("#invitation-template").html();
var template = Handlebars.compile(source);

function getUserSnapshot(){
    let ref, snapshot; 
      // 데이터 불러오기
      var db = firebase.firestore();
      
      ref = db.collection('user'); 
      snapshot = ref.get();
  
      if (snapshot.empty) { // 검색된 데이터가 없는 경우
          console.log(`Fail to load user data.`);
          return;
      }
      console.log(`Success to load user data.`);
      return snapshot;
  }
  

  function getUserData(Snapshots){
    const dataArray = new Array();

    Snapshots.then((snapshot) => {
      snapshot.forEach((doc) => {

        var temp = new Object();
        var emailSplit = doc.get("email").split('@');
        temp.userId = emailSplit[0];
        temp.inviteNum = doc.get("inviteNum");
        //console.log(temp);
        dataArray.push(temp);
        makeRankTable(dataArray);         
      });
    });
  }

  function makeRankTable(dataArray){
      
      dataArray.sort(compNum);
      console.log("sort",dataArray);

      if(dataArray.length > 10){
        dataArray = dataArray.slice(0,10);
      }

      for(k in dataArray){
        dataArray[k].rank = (k*1)+1;
      }

      const data = new Object();
      data.contents = dataArray;
      $("#content-placeholder").html(template(data));
  }

  function compNum(a,b){
    return b.inviteNum - a.inviteNum;
  }

</script>
</html>
