<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Enter-로그인</title>
    <!-- MDB icon -->
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" />
    <!-- Google Fonts Roboto -->
    <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
    />
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../register/register.css">
    <link rel="stylesheet" href="../register/checkbox.css">
    <style>
      .btn-form{
        position: absolute!important;
        right: 0px;
        top: 0px;
        font-size: 18px!important;
        padding: 10px 24px!important;
        text-transform: none!important;
        color: #fff!important;
        background-color: #17375E!important;
        border-radius: 1.5rem!important;
        font-weight: 400!important;
      }
      .post-slider .card{
        border-radius: 2rem !important;
        height: 464px;
        margin: 0px 20px;
        background-color: transparent;
        box-shadow: none;
       
        
      }
      .form-control::placeholder{
        color: #bfbfbf!important;
      }
      .slick-slide{
        border-radius: 1rem;
      }
      button{
        background-color: transparent;
        border: none;

      }
      @media(min-width:2000px){.container,.container-lg,.container-md,.container-sm,.container-xl,.container-xxl{max-width:1920px!important}}
     
      .slick-slider, .slick-list, .slick-track{
        height: 564px;
      }
      .card-body{
        width: 450px;
      }
      @media(max-width: 992px){
       
      }
    </style>
    
    <!-- MDB -->
    <link rel="stylesheet" href="../css/mdb.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <script  src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script src="../js/slick.js"></script>
  
    <script>
      $(document).ready(function(){
        $("#footer").load("../footer.html");
      });
      /*$(document).ready(function(){
          //Example - show a div after 75% of the web page is scrolled.
          var webpage = $("body");
          var webpage_height = webpage.height();
          //alert(webpage_height);
          var trigger_height = webpage_height * 0.5;

          if ($(window).scrollTop() > (webpage_height-trigger_height)) {
            alert($(window).scrollTop()+" > "+(webpage_height-trigger_height));
            //$("#divtoshow").show();
          }
      });*/

      $(document).on('ready',function(){
        $('.post-slider').slick({
          infinite: true,
          varialbeWidth: true,
          centerMode: false,
          slidesToShow: 1,
          slidesToScroll: 1,
          lazyLoad: 'ondemand',
          prevArrow: $('#prev'),
          prevArrow2: $('#prev2'),
          nextArrow: $('#next'),
          nextArrow2: $('#next2'),
  
        });
      });
      
    </script>
  </head>
  <body style="height: 100vh;">
    <div id="navbar"></div>
    <div class="container-fluid bg-container body-h" style="margin-top:113px; padding: 0px;">
      <div class="container-fluid bg-ver body-h" style="padding: 0px;">
        <div class="hr-1"></div>
        <div class="hr-2"></div>
        
        <div class="container bg-ver2 d-flex mobile-ver-center body-h" style="">
          <div class="hr-3"></div>
          <div class="hr-4"></div>
          <div class="hr-5"></div>
          <div class="hr-6"></div>
          <div class="container" style="height: 757px;padding: 0px;position: relative;">
            <div class="circle-1"></div>
            <div class="circle-2"></div>
            <div class="container text-white" style="max-width: 1320px!important;">
              <div class="row">
                <div class="col-lg-6 mobile-nopad" style="padding: 16px;">
                   <div class="post-slider">
                     <div class="card" >
                      <div class="card-body">
                        <div class="card-text">
                          <p class="card-title-1">Enjoy<br>Our Services</p>
                          <p class="card-title-2 mt-5" style="margin-bottom: 100px;">
                            로그인을 한 뒤에 사전등록을 할 수 있습니다. 더 다양한 혜택과 이벤트 알림을
                            위해 사전등록을 진행해 보세요!
                          </p>
                          <a class="btn-rounded text-white text-center" style="font-size: 18px; background-color: #bd464b;padding:12px 19px;" href="">About Service</a>
                        </div>
                    </div>
                  </div>
                  <div class="card" >
                    <div class="card-body">
                      <div class="card-text">
                        dsklfjklsdfjklsdjfklsdfjklsdfj
                      </div>
                  </div>
                </div>
                <div class="card">
                  <div class="card-body">
                    <div class="card-text">
                      dsklfjklsdfjklsdjfklsdfjklsdfj
                    </div>
                </div>
              </div>
              <div class="card">
                <div class="card-body">
                  <div class="card-text">
                    dsklfjklsdfjklsdjfklsdfjklsdfj
                  </div>
              </div>
            </div>
                   </div>
                   <div class="d-flex mobile-middle" style="padding: 32px;">
              
                    <button class='slick-prev' style="color: #fff;z-index: 1;" id="prev"><i class='fas fa-arrow-left'></i></button>
                    <span class="mx-2"><span id="currentPg" style="color: #fff;">1</span> / <span id="maxPg">4</span></span>
                    <button class='slick-next' style="color: #fff; z-index: 1;" id="next"><i class='fas fa-arrow-right'></i></button>
                  </div>
              </div>
                <div class="col-lg-6 mobile-nopad  d-flex mobile-middle" style="height: 757px; padding-left: 30px;z-index: 1;">
                  <div id="whereContentChanges"><div class="sign-up text-center">
                    <div class="sign-up-title">
                      Sign in
                    </div>
                    <input type="email" class="form-control form-rounded mct-5" id="userEmail" placeholder="Your email" style="padding: 10px 20px;">
                    <input type="password" class="form-control form-rounded mct-2" id="userPassword" placeholder="Your Password" style="padding: 10px 20px;">
                    <div class="d-flex mct-3" style="margin-bottom: 17.6px;">
                        <label class="checkbox-container mx-3 text-start">아이디 저장
                            <input type="checkbox" checked="checked">
                            <span class="checkmark"></span>
                          </label>
                          <label class="checkbox-container text-start">자동로그인
                            <input type="checkbox" checked="checked">
                            <span class="checkmark"></span>
                          </label>
                    </div>
                   
                    <button type="submit" class="btn-rounded text-white text-center" style="
                    font-size: 18px;width: 100%;background-color: #17375E;padding: 12px;" onclick="pwLogin()">Sign in</button>
                    <div class="separator mt-3">or</div>
                    <button type="submit" class="btn-rounded text-white text-center mt-3" style="
                    font-size: 18px;width: 100%;background-color: #1da1f2;padding: 12px;" onclick="googleLogin()">Login via Google</button>
                    <button id="register" type="submit" class="btn-rounded text-white text-center mct-1" style="
                    font-size: 18px;width: 100%;background-color: #fae100;padding: 12px;" onclick="kakaoLogin()">Login via Kakao</button>
                    <div class="d-flex mt-3 justify-content-center" style="font-size: 18px;">
                      <div style="color: #bfbfbf;">Don't have an Account?</div>
                      <a class="ms-2" style="color: #59dbe0;" href="../register/register.html">Sign up</a>
                    </div>
                    <div class="text-center mt-1" style="font-size: 14px;color: #bd064b;font-weight: 700;">
                      
                      <div class="pointer" onclick="changePage('change_password')">Forgot Password?</div>
                    </div>
                  </div></div>
                  
                 
              </div>
              </div>
          </div>
          </div>
        </div>
        
    </div>
    </div>
    
    <footer id="footer"></footer>
    

    <!-- MDB -->
    <script type="text/javascript" src="../js/mdb.min.js"></script>
    
    <!-- Custom scripts -->
    <script type="text/javascript">
    $(document).ready(function(){
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      var firebaseConfig = {
          apiKey: "AIzaSyA0E-3mY4_qBgV7RfxEdzcU4B7xjJ74e-c",
          authDomain: "enter-ef3a8.firebaseapp.com",
          databaseURL: "https://enter-ef3a8-default-rtdb.firebaseio.com",
          projectId: "enter-ef3a8",
          storageBucket: "enter-ef3a8.appspot.com",
          messagingSenderId: "505540008688",
          appId: "1:505540008688:web:d3d89e4a7ac7ba57178035",
          measurementId: "G-88XNV769FN"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        firebase.analytics();

        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              $("#navbar").load('../navbar/afterlogin.html');
              console.log(user)		// 인증 후 어떤 데이터를 받아오는지 확인해보기 위함.
              //alert("로그인 완료 "+user.email);
              //window.location.href = "../";
            } else {
              $("#navbar").load('../navbar/beforelogin.html');
              // No user is signed in.
              //alert("로그인 X");
            }
        });
    });
    $(window).load(function(){
      $('#로그인').addClass('active');
    });
    </script>
    <script type="text/javascript" src="../js/pageSlide.js"></script>
  </body>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-analytics.js"></script>

<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-database.js"></script>
<script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
<script src="login.js"></script>
<script src="change_password.js"></script>

<script>
  function googleLogin(){
    console.log("google 로그인 클릭");
    var user = firebase.auth().currentUser;
    if (user) {
      // User is signed in.
      //console.log(user)		// 인증 후 어떤 데이터를 받아오는지 확인해보기 위함.  
      window.location.href = "../";
    } 
    else {
      console.log("google 로그인 시작");
      // No user is signed in.
      var provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth().signInWithRedirect(provider);
    }
  }

  firebase.auth().getRedirectResult()
  .then((result) => {
    if (result.credential) {
        /** @type {firebase.auth.OAuthCredential} */
        var credential = result.credential;
        // This gives you a Google Access Token. You can use it to access the Google API.
        var token = credential.accessToken;
        // ...
      }
      // The signed-in user info.
      var user = result.user;
      console.log("*"+user);
      var db = firebase.firestore();
      db.collection("user").doc(user.uid).set({
          email: user.email,
          signupMethod: "google",
          inviteNum: 0
      }).then(function(){
        updateInvitation();
        if(confirm("google 회원가입 완료"+user.email)){
          window.location.href="../";
        }
      }).catch(function(error) {
          console.error("Error adding document: ", error);
          alert(error.code+" / "+error.message);
      });
    }).catch((error) => {
      // Handle Errors here.
  });

  Kakao.init('8fa8eca2742004d4fa3b93aaf4b736e3'); //발급받은 키 중 javascript키를 사용해준다.
  console.log(Kakao.isInitialized()); // sdk초기화여부판단
  //카카오로그인
  function kakaoLogin() {
    if(!Kakao.isInitialized()){
      Kakao.init('8fa8eca2742004d4fa3b93aaf4b736e3'); //발급받은 키 중 javascript키를 사용해준다.
      console.log(Kakao.isInitialized()); // sdk초기화여부판단
    }
    Kakao.Auth.login({
      scope: "account_email",
      success: function (response) {
        Kakao.API.request({
          url: '/v2/user/me',
          success: function (response) {
            console.log(response)
            //alert(response.id+", "+response.kakao_account.email);
            if(response.kakao_account.email != undefined){
              firebase.auth().signInWithEmailAndPassword(response.kakao_account.email, String(response.id))
              .then((userCredential) => {
                  window.location.href = "../";
              })
              .catch((error) => {
                if(error.code == "auth/user-not-found"){
                  console.log("kakao 로그인 시작");
                  newUser(response.kakao_account.email, String(response.id));
                }
                else{
                  console.log(error.code+"\n"+error.message);
                  alert("로그인 에러 "+error.code+"\n"+error.message);
                }
              });
            }
          },
          fail: function (error) {
            alert("이메일 제공에 동의해주세요:)");
            console.log(error)
          },
        })
      },
      fail: function (error) {
        console.log(error)
      },
    })
  }

  function newUser(email, password){
    firebase.auth().createUserWithEmailAndPassword(email, password)
    .then((user) => {
        var db = firebase.firestore();
        var user1 = firebase.auth().currentUser;
        db.collection("user").doc(user1.uid).set({
            email: email,
            signupMethod: "kakao",
            password: password,
            inviteNum: 0
        })
        .then(function(docRef) {
            updateInvitation();
            sendTo();
            if(confirm("kakao 회원가입 완료 ")+email){
              window.location.href="../";
            }
        })
        .catch(function(error) {
            console.error("Error adding document: ", error);
        });       
    })
    .catch((error) => {
      alert("회원가입 에러 "+error.code+"\n"+error.message);
    });
  }

  //카카오로그아웃  
  function kakaoLogout() {
    if(!Kakao.isInitialized()){
      Kakao.init('8fa8eca2742004d4fa3b93aaf4b736e3'); //발급받은 키 중 javascript키를 사용해준다.
      console.log(Kakao.isInitialized()); // sdk초기화여부판단
    }
    if (Kakao.Auth.getAccessToken()) {
      Kakao.API.request({
        url: '/v1/user/unlink',
        success: function (response) {
          console.log(response)
        },
        fail: function (error) {
          console.log(error)
        },
      })
      Kakao.Auth.setAccessToken(undefined)
    }
  }

  function sendTo() {
    //kakaoLogin();
    Kakao.Auth.login({
      scope: 'TALK_MESSAGE',
      success: function() {
        Kakao.API.request({
          url: '/v2/api/talk/memo/default/send',
          data: {
            template_object: {
              object_type: 'feed',
              content: {
                title: '회원가입이 완료되었습니다',
                description: '',
                image_url:
                  'http://k.kakaocdn.net/dn/Q2iNx/btqgeRgV54P/VLdBs9cvyn8BJXB3o7N8UK/kakaolink40_original.png',
                link: {
                  mobile_web_url: 'https://enter-ef3a8.web.app/',
                  web_url: 'https://enter-ef3a8.web.app/',
                },
              },
              social: {
                like_count: 286,
                comment_count: 45,
                shared_count: 845,
              },
              buttons: [
                {
                  title: '웹으로 보기',
                  link: {
                    mobile_web_url: 'https://enter-ef3a8.web.app/',
                    web_url: 'https://enter-ef3a8.web.app/',
                  },
                },
              ],
            },
          },
          success: function(res) {
            //alert('success: ' + JSON.stringify(res))
            window.location.href = "../";
          },
          fail: function(err) {
            alert('error: ' + JSON.stringify(err))
          },
        })
      },
      fail: function(err) {
        alert('failed to login: ' + JSON.stringify(err))
      },
    })
  }
</script>
</html>
